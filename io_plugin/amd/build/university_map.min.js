define(["jquery","core/ajax","core/notification","core/str"],function($,Ajax,Notification,Str){var map=null,markersLayer=null,leafletLib=null,addUniversitiesToMap=function(universities){console.log("Adding universities to map"),markersLayer.clearLayers();var countryClusters={};if(universities.forEach(function(university){var marker;university.latitude&&university.longitude&&(marker=leafletLib.marker([university.latitude,university.longitude]).bindPopup(createPopupContent(university)),markersLayer.addLayer(marker),countryClusters[university.country]||(countryClusters[university.country]=[]),countryClusters[university.country].push(marker))}),0<markersLayer.getLayers().length)try{var bounds=leafletLib.featureGroup(markersLayer.getLayers()).getBounds();map.fitBounds(bounds,{padding:[50,50]})}catch(error){console.error("Error fitting bounds:",error)}},createPopupContent=function(university){var content='<div class="university-popup">',content=(content+="<h4>"+university.name+"</h4>")+("<p><strong>"+university.city+", "+university.country+"</strong></p>");return university.available_slots&&(content+="<p>Available Slots: "+university.available_slots+"</p>"),university.reports_count&&(content+="<p>Experience Reports: "+university.reports_count+"</p>"),content=content+('<a href="'+university.detail_url+'" class="btn btn-primary btn-sm mt-2">View Details</a>')+"</div>"},setupViewSwitcher=function(){$(".dhbwio-view-switcher a").on("click",function(e){e.preventDefault();var e=$(this),view=e.attr("href").split("view=")[1];$(".dhbwio-view-switcher a").removeClass("active btn-primary").addClass("btn-secondary"),e.removeClass("btn-secondary").addClass("active btn-primary"),"map"===view?($("#university-list").hide(),$("#university-map-container").show(),map&&map.invalidateSize()):($("#university-map-container").hide(),$("#university-list").show())})};return{init:function(courseModuleId){var cmid=courseModuleId;$(document).ready(function(){$("#university-map").length?(console.log("Map container found, initializing map for CM ID:",cmid),(()=>{if(console.log("initMap called"),"undefined"==typeof L){if(void 0===window.L)return console.error("Leaflet library not loaded"),Notification.exception({message:"Leaflet library not loaded"});leafletLib=window.L,console.log("Found Leaflet as window.L")}else leafletLib=L,console.log("Leaflet already available as L");try{console.log("Creating map"),map=leafletLib.map("university-map").setView([30,10],2),leafletLib.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{}).addTo(map),console.log("Map created, adding marker layer"),markersLayer=leafletLib.layerGroup().addTo(map),setupViewSwitcher()}catch(error){console.error("Error creating map:",error),Notification.exception({message:"Error creating map: "+error.message})}})(),map&&(cmid=>{console.log("Loading universities data"),$("#university-map").addClass("loading"),Ajax.call([{methodname:"mod_dhbwio_get_universities",args:{cmid:cmid},done:function(response){console.log("Universities data loaded:",response),response&&response.universities&&addUniversitiesToMap(response.universities),$("#university-map").removeClass("loading")},fail:function(error){console.error("Error loading universities:",error),Notification.exception(error),$("#university-map").removeClass("loading")}}])})(cmid)):console.error("Map container not found")})}}});
//# sourceMappingURL=university_map.min.js.map