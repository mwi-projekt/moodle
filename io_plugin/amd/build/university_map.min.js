define(["jquery","core/ajax","core/notification","core/str"],function(a,r,i,t){let n=null,s=null,l=null,d={};let c=e=>{console.log("Adding universities to map"),s.clearLayers();let a={};if(e.forEach(e=>{var o;e.latitude&&e.longitude&&(o=l.marker([e.latitude,e.longitude]).bindPopup(p(e)),s.addLayer(o),a[e.country]||(a[e.country]=[]),a[e.country].push(o))}),0<s.getLayers().length)try{var o=l.featureGroup(s.getLayers()).getBounds();n.fitBounds(o,{padding:[50,50]})}catch(e){console.error("Error fitting bounds:",e)}},p=e=>{let o='<div class="university-popup">';return o=(o+=`<h4>${e.name}</h4>`)+`<p><strong>${e.city}, ${e.country}</strong></p>`,e.available_slots&&(o+=`<p>${d.availableSlots}: ${e.available_slots}</p>`),e.reports_count&&(o+=`<p>${d.reports}: ${e.reports_count}</p>`),o=o+`<a href="${e.detail_url}" class="btn btn-primary btn-sm mt-2">${d.viewDetails}</a>`+"</div>"},u=()=>{a(".dhbwio-view-switcher a").on("click",e=>{e.preventDefault();var e=a(e.currentTarget),o=e.attr("href").split("view=")[1];a(".dhbwio-view-switcher a").removeClass("active btn-primary").addClass("btn-secondary"),e.removeClass("btn-secondary").addClass("active btn-primary"),"map"===o?(a("#university-list").hide(),a("#university-map-container").show(),n&&n.invalidateSize()):(a("#university-map-container").hide(),a("#university-list").show())})};return{init:async e=>{let o=e;await(async()=>{try{var e=await t.get_strings([{key:"university_available_slots",component:"mod_dhbwio"},{key:"reports",component:"mod_dhbwio"},{key:"view_details",component:"mod_dhbwio"},{key:"loading_universities",component:"mod_dhbwio"},{key:"map_loading_error",component:"mod_dhbwio"},{key:"leaflet_not_loaded",component:"mod_dhbwio"},{key:"map_creation_error",component:"mod_dhbwio"}]);d={availableSlots:e[0],reports:e[1],viewDetails:e[2],loadingUniversities:e[3],mapLoadingError:e[4],leafletNotLoaded:e[5],mapCreationError:e[6]}}catch(e){d={availableSlots:"Available Slots",reports:"Reports",viewDetails:"View Details",loadingUniversities:"Loading universities...",mapLoadingError:"Error loading universities",leafletNotLoaded:"Leaflet library not loaded",mapCreationError:"Error creating map"},console.warn("Could not load language strings, using fallback:",e)}})(),a(document).ready(()=>{a("#university-map").length?(console.log("Map container found, initializing map for CM ID:",o),(()=>{if(console.log("initMap called"),typeof L==="undefined")if(typeof window.L!=="undefined"){l=window.L;console.log("Found Leaflet as window.L")}else{console.error("Leaflet library not loaded");i.exception({message:d.leafletNotLoaded});return}else{l=L;console.log("Leaflet already available as L")}try{console.log("Creating map");n=l.map("university-map").setView([30,10],2);l.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"&copy; Esri"}).addTo(n);console.log("Map created, adding marker layer");s=l.layerGroup().addTo(n);u()}catch(e){console.error("Error creating map:",e);i.exception({message:`${d.mapCreationError}: ${e.message}`})}})(),n&&(async e=>{console.log("Loading universities data"),a("#university-map").addClass("loading");try{const o=await r.call([{methodname:"mod_dhbwio_get_universities",args:{cmid:e}}])[0];console.log("Universities data loaded:",o);if(o&&o.universities)c(o.universities);a("#university-map").removeClass("loading")}catch(e){console.error("Error loading universities:",e);i.exception({message:d.mapLoadingError,error:e});a("#university-map").removeClass("loading")}})(o)):console.error("Map container not found")})}}});
//# sourceMappingURL=university_map.min.js.map