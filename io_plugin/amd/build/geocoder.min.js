define(["jquery","core/ajax","core/notification","core/str"],function(a,t,d,o){let n={},e=!1;let i=e=>{e.preventDefault(),s()},r=()=>{var e=a("#id_city").val().trim(),o=a("#id_country").val().trim(),i=a("#id_geocode_button");e&&o?i.prop("disabled",!1):i.prop("disabled",!0)},s=async()=>{var e=a("#id_address").val().trim(),o=a("#id_postal_code").val().trim(),i=a("#id_city").val().trim(),r=a("#id_country").val().trim();if(i&&r){e=[e,o,i,r].filter(Boolean).join(", "),o=a("#id_geocode_button"),i=o.text();o.prop("disabled",!0),c("loading",n.inProgress);try{var s=await t.call([{methodname:"mod_dhbwio_geocode_address",args:{address:e}}])[0];l(s)}catch(e){console.error("Geocoding error:",e),c("error",n.error),d.exception(e)}finally{o.prop("disabled",!1).text(i)}}else c("error",n.missingFields)},l=e=>{var o,i,r;e?e.success?(o=parseFloat(e.latitude),i=parseFloat(e.longitude),isNaN(o)||isNaN(i)||o<-90||90<o||i<-180||180<i?c("error",n.invalidResponse):(a("#id_latitude").val(o.toFixed(6)),a("#id_longitude").val(i.toFixed(6)),a("#id_latitude, #id_longitude").trigger("change"),r=`${n.success} (${o.toFixed(4)}, ${i.toFixed(4)})`,c("success",r),g(o,i))):(r=e.message||n.noResults,c("error",r)):c("error",n.invalidResponse)},c=(e,o)=>{var i=a("#geocode_status");i.empty();let r="alert",s="";switch(e){case"success":r+=" alert-success",s='<i class="fa fa-check-circle" aria-hidden="true"></i> ';break;case"error":r+=" alert-danger",s='<i class="fa fa-exclamation-circle" aria-hidden="true"></i> ';break;case"loading":r+=" alert-info",s='<div class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></div>'}e=`
            <div class="${r} mt-2" role="alert">
                ${s}${o}
            </div>
        `;i.html(e)},g=(e,o)=>{var i=a("#coordinate_preview");i.length&&i.html(`
                <div class="mt-2">
                    <small class="text-muted">
                        <a href="${`https://www.openstreetmap.org/?mlat=${e}&mlon=${o}&zoom=15`}" target="_blank" rel="noopener">
                            <i class="fa fa-external-link" aria-hidden="true"></i>
                            View on map
                        </a>
                    </small>
                </div>
            `)};return{init:async()=>{e||(await(async()=>{try{var e=await o.get_strings([{key:"geocoding_missing_fields",component:"mod_dhbwio"},{key:"geocoding_in_progress",component:"mod_dhbwio"},{key:"geocoding_success",component:"mod_dhbwio"},{key:"geocoding_error",component:"mod_dhbwio"},{key:"geocoding_no_results",component:"mod_dhbwio"},{key:"geocoding_invalid_response",component:"mod_dhbwio"}]);n={missingFields:e[0],inProgress:e[1],success:e[2],error:e[3],noResults:e[4],invalidResponse:e[5]}}catch(e){n={missingFields:"Please provide at least city and country.",inProgress:"Geocoding in progress...",success:"Coordinates found successfully!",error:"Error occurred during geocoding.",noResults:"No coordinates found for the given address.",invalidResponse:"Invalid response from geocoding service."},console.warn("Could not load language strings, using fallback:",e)}})(),a("#id_geocode_button").on("click",i),a("#id_city, #id_country").on("input",r),e=!0)},performGeocoding:s,clearResults:()=>{a("#id_latitude, #id_longitude").val(""),a("#geocode_status").empty(),a("#coordinate_preview").empty()},getCurrentCoordinates:()=>{var e=parseFloat(a("#id_latitude").val()),o=parseFloat(a("#id_longitude").val());return isNaN(e)||isNaN(o)?null:{latitude:e,longitude:o}}}});
//# sourceMappingURL=geocoder.min.js.map